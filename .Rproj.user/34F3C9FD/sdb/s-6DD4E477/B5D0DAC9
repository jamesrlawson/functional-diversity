{
    "contents" : "#############################################################################################\n#################### ANALYSIS FOR ONLY SPP. WITH COMPLETE DATA ####################\n#############################################################################################\n#################### LHS + woody/herbaceous ##################################################\n\nsource(\"scripts/functions.R\")\noptions(stringsAsFactors = FALSE)\nlibrary(plyr)\nlibrary(ggplot2)\nlibrary(reshape)\nlibrary(FD)\n\n#############################################################################################\n############################# GET RELATIVE ABUNDANCES FOR ALL TRAITS ########################\n#############################################################################################\n\n# load in data\n\nalltraits <- read.csv(\"data/alltraits.csv\", header=TRUE)\npercentcover <- read.csv(\"data/percentcover.csv\", header=TRUE)\nhydro <- read.csv(\"data/hydro_all.csv\", header=TRUE)\nWD <- read.csv(\"data/WD.csv\", header=TRUE)\nWDferns <- read.csv(\"data/WD.csv\", header=TRUE)\n\n\n\n# remove observations that average less than 1% cover\npercentcover <- subset(percentcover, avgcover > 1)\n\n# generate df with total % cover (across all strata) of species at each plot\nplotsums <- ddply(percentcover, .(plotID, species), summarise, speciescover = sum(avgcover))\n\n# test how much % cover per plot is reduced by applying na.omit to trait data\n\nallspp <- alltraits\nallspp$growthform <- NULL\n\nallspp.cover <- findtraitvals(plotsums, allspp)\n\nrichness.all <- tapply(allspp.cover$species, allspp.cover$plotID, length)\nplotcover.all <- tapply(allspp.cover$speciescover, allspp.cover$plotID, sum)\n\nallspp <- alltraits\nallspp <- na.omit(allspp)\n# add in the ferns that got omitted due to no seedmass data\n#allspp <- rbind(allspp, alltraits[53,]) # Calochlaena dubia\n#allspp <- rbind(allspp, alltraits[43,]) # Doodia aspera\n#allspp <- rbind(allspp, alltraits[113,]) # Blechnum nudum\n\nallspp <- allspp[order(allspp$species), ]\nallspp$WD <- WD$WD\nallspp$growthform <- NULL\n\nallspp.cover <- findtraitvals(plotsums, allspp)\n\nrichness.naomit <- tapply(allspp.cover$species, allspp.cover$plotID, length)\nplotcover.naomit <- tapply(allspp.cover$speciescover, allspp.cover$plotID, sum)\n\ndataDensity <- data.frame(cbind(\"richness\" = richness.naomit / richness.all,\n                                \"plotcover\" = plotcover.naomit / plotcover.all))\n\n#View(dataDensity)\n\n###\n\nallspp.totalcover <- ddply(allspp.cover, .(plotID), summarise, totalcover = sum(speciescover))\nallspp.cover <- merge(allspp.cover, allspp.totalcover, by.x = \"plotID\", by.y = \"plotID\")\nallspp.cover <-relabund(allspp.cover)\n\ntest <- ddply(allspp.cover, .(plotID), summarise, summedRelCover = (sum(relcover)))\nprint(test)\nrm(test)\n\n#######\n\ntraits <- allspp.cover[2]\ntraits <- cbind(traits, allspp.cover[4:10])\ntraits$lifehistory <- NULL\ntraits <- ddply(traits, .(species), unique)\n\n# transform traits\n\nhist(log10(traits$seedmass))\nhist(log10(traits$SLA))\nhist(log10(traits$maxheight), breaks = 5)\nhist((traits$flowering.period)) # non-normal distribution with any common transform\n\ntraits$seedmass <- log10(traits$seedmass)\ntraits$SLA <- log10(traits$SLA)\ntraits$maxheight <- log10(traits$maxheight)\n\ntraits$woody <- as.numeric(traits$woody)\n#traits$lifehistory <- as.numeric(traits$lifehistory)\n\n\n# create abun, in correct input format for FD analysis\n\nabun <- data.frame(allspp.cover[1])\nabun <- cbind(abun, allspp.cover[2])\nabun <- cbind(abun, allspp.cover[12])\nabun <- cast(abun, plotID ~ species, value=\"relcover\", fill=0)\nrownames(abun) <- abun$plotID\nabun$plotID <- NULL\n\nspp <- traits$species \ntraits$species <- NULL\nrownames(traits) <- spp\nrm(spp)\n\n### run FD analysis ### important that traits are scaled (stand.x = TRUE)\n### 12 groups ###\n\nFD.dbfd <- dbFD(traits, \n                abun, \n                w.abun = TRUE, \n                stand.x = TRUE,\n                ord = c(\"metric\"),\n                corr = c(\"cailliez\"),\n                calc.FGR = TRUE, \n                calc.FDiv = TRUE, \n                calc.CWM=TRUE, \n                clust.type=\"ward\", \n                print.pco=TRUE, \n#                scale.RaoQ=TRUE, \n                stand.FRic=TRUE)\n\nhydroplots <- hydro\n\nhydroplots$FDis <- FD.dbfd$FDis\nhydroplots$FDiv <- FD.dbfd$FDiv\nhydroplots$FRic <- FD.dbfd$FRic\nhydroplots$FEve <- FD.dbfd$FEve\nhydroplots$RaoQ <- FD.dbfd$RaoQ\nhydroplots$FGR <- FD.dbfd$FGR\nhydroplots$nbsp <- FD.dbfd$nbsp\n\nCWM <- FD.dbfd$CWM\n\nhydroplots$SLA.CWM <- CWM$SLA\nhydroplots$seedmass.CWM <- CWM$seedmass\nhydroplots$maxheight.CWM <- CWM$maxheight\nhydroplots$flowering.period.CWM <- CWM$flowering.period\nhydroplots$WD.CWM <- CWM$WD\n\n\nCWM$woody <- NULL\nCWM$lifehistory <- NULL\n\n#View(cor(CWM))\n#pairs(CWM)\n\n## try a Tukey's test to compare hydro categories ##\n\nFDis.aov <- aov(hydroplots$FDis ~ as.factor(hydroplots$category))\nTukeyHSD(FDis.aov)\n\n## plot everything against hydro ##\n\nplot.linear(hydroplots, hydroplots$FDis, FD)\nplot.linear(hydroplots, hydroplots$FDiv, FD)\nplot.linear(hydroplots, hydroplots$FRic, FD)\nplot.linear(hydroplots, hydroplots$FEve, FD)\nplot.linear(hydroplots, hydroplots$nbsp, FD)\n\nplot.linear(hydroplots, hydroplots$SLA.CWM, CWM)\nplot.linear(hydroplots,hydroplots$seedmass.CWM, CWM)\nplot.linear(hydroplots, hydroplots$maxheight.CWM, CWM)\nplot.linear(hydroplots, hydroplots$flowering.period.CWM, CWM)\nplot.linear(hydroplots, hydroplots$WD.CWM, CWM)\n\n\nplot.quad(hydroplots, hydroplots$FDis, FD)\nplot.quad(hydroplots, hydroplots$FDiv, FD)\nplot.quad(hydroplots,hydroplots$FRic, FD)\nplot.quad(hydroplots, hydroplots$FEve, FD)\nplot.quad(hydroplots, hydroplots$nbsp, FD)\n\nplot.quad(hydroplots, hydroplots$SLA.CWM, CWM)\nplot.quad(hydroplots,hydroplots$seedmass.CWM, CWM)\nplot.quad(hydroplots, hydroplots$maxheight.CWM, CWM)\nplot.quad(hydroplots, hydroplots$flowering.period.CWM, CWM)\nplot.quad(hydroplots, hydroplots$WD.CWM, CWM)\n\n\n\ngetStats(hydroplots, hydroplots$FDis, FD)\ngetStats(hydroplots, hydroplots$FDiv, FD)\ngetStats(hydroplots, hydroplots$FRic, FD)\ngetStats(hydroplots, hydroplots$FEve, FD)\ngetStats(hydroplots, hydroplots$nbsp, FD)\n\ngetStats(hydroplots, hydroplots$SLA.CWM, CWM)\ngetStats(hydroplots,hydroplots$seedmass.CWM, CWM)\ngetStats(hydroplots, hydroplots$maxheight.CWM, CWM)\ngetStats(hydroplots, hydroplots$flowering.period.CWM, CWM)\ngetStats(hydroplots, hydroplots$WD.CWM, CWM)\n\n\n\n",
    "created" : 1403237951610.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "3858631073",
    "id" : "B5D0DAC9",
    "lastKnownWriteTime" : 1404279092,
    "path" : "C:/Users/JLawson/Desktop/stuff/data/analysis/R/functional diversity/scripts/analysis.R",
    "project_path" : "scripts/analysis.R",
    "properties" : {
        "tempName" : "Untitled1"
    },
    "source_on_save" : false,
    "type" : "r_source"
}